<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Display</title>
<link rel="stylesheet" href="/css/style.css">
</head>

<body>
<header class="header">
  <img src="/logo.png" class="logo">
</header>

<div class="tv-wrap">
  <div class="tv-body">
    <div class="order-grid" id="orders"></div>
  </div>
</div>

<script>
const ordersEl=document.getElementById('orders');

function showOrder(o){
  const div=document.createElement('div');
  div.className='order-card';
  div.dataset.id=o.id;

  div.innerHTML=`
    <div class="order-num">${o.order}</div>
    <div class="order-meta">
      <div class="small">${o.note||''}</div>
      <div class="small">${new Date(o.ts).toLocaleTimeString()}</div>
    </div>
  `;
  ordersEl.prepend(div);
}

/* SSE */
const es=new EventSource('/events');
es.onmessage=e=>{
  const data=JSON.parse(e.data);

  if(data.type==='init'){
    ordersEl.innerHTML='';
    data.orders.forEach(showOrder);
  }

  if(data.type==='add'){ showOrder(data.order); }

  if(data.type==='remove'){
    document.querySelectorAll('.order-card').forEach(c=>{
      if(c.dataset.id===data.id) c.remove();
    });
  }

  if(data.type==='clear'){ ordersEl.innerHTML=''; }
};
</script>
</body>
</html>
