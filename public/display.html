<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lakshmi Bhavan â€” Ready Orders (Display)</title>

  <link rel="stylesheet" href="/css/style.css">
  <meta name="theme-color" content="#0b6efd">
</head>

<body>
  <header class="header">
    <img src="logo.png" alt="Lakshmi Bhavan logo" class="logo">
  </header>
  <div class="lb"></div>

  <div class="tv-wrap">
    <div class="tv-body">
      <div class="order-grid" id="orders"></div>
    </div>
  </div>

  <footer class="footer">
    Â© Lakshmi Bhavan
  </footer>

  <script>
    const ordersEl = document.getElementById('orders');

    function formatTime(ts) {
      return new Date(ts).toLocaleTimeString();
    }

    function showOrder(o) {
      const div = document.createElement('div');
      div.className = 'card';
      div.dataset.id = o.id;

      div.innerHTML = `
        <div class="order-num">${o.order}</div>
        <div class="time">${formatTime(o.ts)}</div>
        <div class="note">${o.note || ''}</div>
      `;

      ordersEl.prepend(div);
    }

    /* ðŸ”´ SSE */
    const es = new EventSource('/events');

    es.onmessage = (e) => {
      const data = JSON.parse(e.data);

      if (data.type === 'init') {
        ordersEl.innerHTML = '';
        data.orders.forEach(showOrder);
      }

      if (data.type === 'add') {
        showOrder(data.order);
      }

      if (data.type === 'remove') {
        document.querySelectorAll('.card').forEach(card => {
          if (card.dataset.id === data.id) card.remove();
        });
      }
    };
  </script>
</body>
</html>
