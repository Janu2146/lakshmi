<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lakshmi Bhavan â€” Ready Orders (Display)</title>

  <link rel="stylesheet" href="/css/style.css">
  <meta name="theme-color" content="#0b6efd">
</head>

<body>
  <header class="header">
    <img src="logo.png" alt="Lakshmi Bhavan logo" class="logo">
  </header>
  <div class="lb"></div>

  <div class="tv-wrap">
    <div class="tv-body">
      <div class="order-grid" id="orders"></div>
    </div>
  </div>

  <footer class="footer">
    Â© Lakshmi Bhavan
  </footer>
<script>
  const ordersEl = document.getElementById('orders');

  function formatTime(ts) {
    return new Date(ts).toLocaleTimeString([], {
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  function showOrder(o) {
    const div = document.createElement('div');
    div.className = 'order-card';      // âœ… correct class
    div.dataset.id = o.id;

    div.innerHTML = `
      <div class="order-num">${o.order}</div>
      <div class="order-meta">
        <div class="small">${formatTime(o.ts)}</div>
        ${o.note ? `<div class="small">${o.note}</div>` : ``}
      </div>
    `;

    ordersEl.prepend(div);
  }

  /* ðŸ”´ SSE */
  const es = new EventSource('/events');

  es.onmessage = (e) => {
    const data = JSON.parse(e.data);

    if (data.type === 'init') {
      ordersEl.innerHTML = '';
      data.orders.forEach(showOrder);
    }

    if (data.type === 'add') {
      showOrder(data.order);
    }

    if (data.type === 'remove') {
      document.querySelectorAll('.order-card').forEach(card => {
        if (card.dataset.id === data.id) card.remove();
      });
    }

    if (data.type === 'clear') {
      ordersEl.innerHTML = '';
    }
  };
</script>


</body>
</html>
