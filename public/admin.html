<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin</title>
<link rel="stylesheet" href="/css/style.css">
</head>

<body>
<header class="header">
  <img src="/logo.png" class="logo">
</header>

<div class="container" style="max-width:1000px;margin:40px auto">
<div class="card">

<h3>Mark Order Ready</h3>

<div style="display:flex;gap:12px">
  <input id="orderInput" placeholder="Order number" style="flex:1;padding:14px">
  <button id="sendBtn" style="width:90px">Ready</button>
</div>

<input id="noteInput" placeholder="Optional note" style="margin-top:10px;width:100%;padding:12px">

<div style="display:flex;justify-content:space-between;margin-top:18px">
  <div>Ready Orders</div>
  <button id="clearBtn" style="background:#c35400;color:white">Clear All</button>
</div>

<div id="recent"></div>
</div>
</div>

<script>
const orderInput = document.getElementById('orderInput');
const noteInput  = document.getElementById('noteInput');
const sendBtn    = document.getElementById('sendBtn');
const clearBtn   = document.getElementById('clearBtn');
const recent     = document.getElementById('recent');

let orders = [];

sendBtn.onclick = ()=>{
  if(!orderInput.value.trim()) return;

  fetch('/ready-order',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      order:orderInput.value.trim(),
      note:noteInput.value.trim()
    })
  });

  orderInput.value='';
  noteInput.value='';
};

clearBtn.onclick = ()=>{
  fetch('/clear-orders',{method:'POST'});
};

function deleteOrder(id){
  fetch('/remove-order',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ id })
  });
}

function render(){
  recent.innerHTML='';
  orders.forEach(o=>{
    const row=document.createElement('div');
    row.innerHTML=`
      <div style="display:flex;gap:16px;padding:10px 0;border-bottom:1px solid #eee">
        <div style="width:80px;font-size:22px">${o.order}</div>
        <div style="flex:1">${o.note||''}</div>
        <button onclick="deleteOrder('${o.id}')" style="background:#8B4513;color:white">Delete</button>
      </div>
    `;
    recent.appendChild(row);
  });
}

/* SSE */
const es=new EventSource('/events');
es.onmessage=e=>{
  const data=JSON.parse(e.data);

  if(data.type==='init'){ orders=data.orders; render(); }
  if(data.type==='add'){ orders.unshift(data.order); render(); }
  if(data.type==='remove'){ orders=orders.filter(o=>o.id!==data.id); render(); }
  if(data.type==='clear'){ orders=[]; render(); }
};
</script>
</body>
</html>
